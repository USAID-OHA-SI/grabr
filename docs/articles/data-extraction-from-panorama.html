<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Extraction from Panorama • grabr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data Extraction from Panorama">
<meta property="og:description" content="grabr">
<meta property="og:image" content="https://usaid-oha-si.github.io/grabr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">grabr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-extraction-from-panorama.html">Data Extraction from Panorama</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USAID-OHA-SI/grabr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data Extraction from Panorama</h1>
                        <h4 data-toc-skip class="author">Baboyma
Kagniniwa</h4>
            
            <h4 data-toc-skip class="date">2021-09-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USAID-OHA-SI/grabr/blob/HEAD/vignettes/data-extraction-from-panorama.Rmd" class="external-link"><code>vignettes/data-extraction-from-panorama.Rmd</code></a></small>
      <div class="hidden name"><code>data-extraction-from-panorama.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This vignette provides guidance on how to identify and extract data
sets output files stored in an S/FTP site.</p>
</div>
<div class="section level3">
<h3 id="datasets">Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h3>
<p>PEPFAR/Panorama releases, on the quarterly basis, global programs’
Monitoring, Evaluation and Reporting (MER), Financial, SIMS, and
Narratives.</p>
</div>
<div class="section level3">
<h3 id="pre-requisites">Pre-requisites<a class="anchor" aria-label="anchor" href="#pre-requisites"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USAID-OHA-SI/glamr" class="external-link">glamr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USAID-OHA-SI/grabr" class="external-link">grabr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-an-active-session">Create an active session<a class="anchor" aria-label="anchor" href="#create-an-active-session"></a>
</h3>
<p>Panorama is a protected site and all user will need to authenticate
in order to order to explore the dashboards. Same is true for data
extraction. To create an active and valid session for all the http
requests, we will use <code><a href="../reference/pano_session.html">pano_session()</a></code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/glamr/man/load_secrets.html" class="external-link">load_secrets</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">user</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glamr/man/pano_user.html" class="external-link">pano_user</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glamr/man/pano_pwd.html" class="external-link">pano_pwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sess</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pano_session.html">pano_session</a></span><span class="op">(</span>username <span class="op">=</span> <span class="va">user</span>, password <span class="op">=</span> <span class="va">pass</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-content-from-download-page">Extract content from download page<a class="anchor" aria-label="anchor" href="#extract-content-from-download-page"></a>
</h3>
<p>In order to extract the list of data items on the download page, we
will need to get the html content of the page first.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://pepfar-panorama.org/forms/downloads/"</span></span>
<span></span>
<span><span class="va">cont</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pano_content.html">pano_content</a></span><span class="op">(</span>page_url <span class="op">=</span> <span class="va">url</span>, session <span class="op">=</span> <span class="va">sess</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cont</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-data-items-details">Extract data items details<a class="anchor" aria-label="anchor" href="#extract-data-items-details"></a>
</h3>
<p>The details of the data items are embeded into the html content. Most
of them are listed as a hyperlink within a <code>&lt;li&gt;</code>
element. The function <code><a href="../reference/pano_elements.html">pano_elements()</a></code> allows us to extract
all those items as a tibble.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dirs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pano_elements.html">pano_elements</a></span><span class="op">(</span>page_html <span class="op">=</span> <span class="va">cont</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dirs</span></span>
<span></span>
<span><span class="va">dir_mer_path</span> <span class="op">&lt;-</span> <span class="va">dirs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">item</span>, <span class="st">"^MER"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mer_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pano_content.html">pano_content</a></span><span class="op">(</span>page_url <span class="op">=</span> <span class="va">dir_mer_path</span>, session <span class="op">=</span> <span class="va">sess</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/pano_elements.html">pano_elements</a></span><span class="op">(</span>page_url <span class="op">=</span> <span class="va">dir_mer_path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mer_items</span></span></code></pre></div>
<p><code><a href="../reference/pano_items.html">pano_items()</a></code> combines <code><a href="../reference/pano_content.html">pano_content()</a></code> and
<code><a href="../reference/pano_elements.html">pano_elements()</a></code> into 1 function for a quick access to data
items list on a specific page.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mer_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pano_items.html">pano_items</a></span><span class="op">(</span>page_url <span class="op">=</span> <span class="va">dir_mer_path</span>, session <span class="op">=</span> <span class="va">sess</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">mer_items</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-specific-items-from-panorama">Download specific items from Panorama<a class="anchor" aria-label="anchor" href="#download-specific-items-from-panorama"></a>
</h3>
<p>Most data items under the download page of Panorama are listed as
zipped files. To download them to a local directory, we will need to use
the <code><a href="../reference/pano_download.html">pano_download()</a></code> function. This function is a wrapper
for <code><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">httr::GET()</a></code> function write option set to a local
directory.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dest_path</span> <span class="op">&lt;-</span> <span class="st">"../../../Temp/"</span></span>
<span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="va">mer_items</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"file zip_file"</span>,</span>
<span>         <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">item</span>, <span class="st">".*_PSNU_IM_FY19-21_.*.zip$"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">url</span></span>
<span></span>
<span><span class="fu"><a href="../reference/pano_download.html">pano_download</a></span><span class="op">(</span>item_url <span class="op">=</span> <span class="va">url</span>, session <span class="op">=</span> <span class="va">sess</span>, dest <span class="op">=</span> <span class="va">dest_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-mutiple-items-from-panorama">Download mutiple items from Panorama<a class="anchor" aria-label="anchor" href="#download-mutiple-items-from-panorama"></a>
</h3>
<p><code><a href="../reference/pano_extract.html">pano_extract()</a></code> is good for batch processing. Eg:
download all MER data sets from Panorama. This function combine all the
above steps into one.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pano_extract.html">pano_extract</a></span><span class="op">(</span>item <span class="op">=</span> <span class="st">"mer"</span>, </span>
<span>                      version <span class="op">=</span> <span class="st">"clean"</span>, </span>
<span>                      fiscal_year <span class="op">=</span> <span class="fl">2021</span>, </span>
<span>                      quarter <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                      username <span class="op">=</span> <span class="va">user</span>,</span>
<span>                      password <span class="op">=</span> <span class="va">pass</span>,</span>
<span>                      unpack <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">items</span></span>
<span></span>
<span><span class="va">url_items</span> <span class="op">&lt;-</span> <span class="va">items</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"file zip_file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># remove this to downlaod all zipped files</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="../reference/pano_download.html">pano_download</a></span><span class="op">(</span>item_url <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                      session <span class="op">=</span> <span class="va">sess</span>, </span>
<span>                      dest <span class="op">=</span> <span class="va">dest_path</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-msd-ou-specific-items-from-panorama">Download MSD / OU Specific items from Panorama<a class="anchor" aria-label="anchor" href="#download-msd-ou-specific-items-from-panorama"></a>
</h3>
<p><code><a href="../reference/pano_extract_msd.html">pano_extract_msd()</a></code> is designed to facilitate the
download of MSD files for specific operating units and at a specific org
hierarchy level. Eg: download Zambia’s Site x IM data sets from
Panorama.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="../reference/pano_extract_msd.html">pano_extract_msd</a></span><span class="op">(</span>operatingunit <span class="op">=</span> <span class="st">"Zambia"</span>,</span>
<span>                version <span class="op">=</span> <span class="st">"clean"</span>,</span>
<span>                fiscal_year <span class="op">=</span> <span class="fl">2021</span>,</span>
<span>                quarter <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                level <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>                dest_path <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-latest-msd-ou-specific-items-from-panorama">Download latest MSD / OU Specific items from Panorama<a class="anchor" aria-label="anchor" href="#download-latest-msd-ou-specific-items-from-panorama"></a>
</h3>
<p><code><a href="../reference/pano_extract_msds.html">pano_extract_msds()</a></code> is designed to facilitate the
download and management of latest MSD files for global and/or specific
operating units. The function will move existing files to an
<code>archive</code> folder before downloading current files.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="../reference/pano_extract_msds.html">pano_extract_msds</a></span><span class="op">(</span>operatingunit <span class="op">=</span> <span class="st">"Zambia"</span>,</span>
<span>                    archive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    dest_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glamr/man/si_path.html" class="external-link">si_path</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Aaron Chafetz, Tim Essam, Baboyma Kagniniwa.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
