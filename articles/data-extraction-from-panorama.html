<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="grabr">
<title>Data Extraction from Panorama • grabr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Extraction from Panorama">
<meta property="og:description" content="grabr">
<meta property="og:image" content="https://usaid-oha-si.github.io/grabr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">grabr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-extraction-from-panorama.html">Data Extraction from Panorama</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USAID-OHA-SI/grabr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data Extraction from Panorama</h1>
                        <h4 data-toc-skip class="author">Baboyma
Kagniniwa</h4>
            
            <h4 data-toc-skip class="date">2021-09-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USAID-OHA-SI/grabr/blob/HEAD/vignettes/data-extraction-from-panorama.Rmd" class="external-link"><code>vignettes/data-extraction-from-panorama.Rmd</code></a></small>
      <div class="d-none name"><code>data-extraction-from-panorama.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This vignette provides guidance on how to identify and extract data
sets output files stored in an S/FTP site.</p>
</div>
<div class="section level3">
<h3 id="datasets">Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h3>
<p>PEPFAR/Panorama releases, on the quarterly basis, global programs’
Monitoring, Evaluation and Reporting (MER), Financial, SIMS, and
Narratives.</p>
</div>
<div class="section level3">
<h3 id="pre-requisites">Pre-requisites<a class="anchor" aria-label="anchor" href="#pre-requisites"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glamr</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USAID-OHA-SI/grabr" class="external-link">grabr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-an-active-session">Create an active session<a class="anchor" aria-label="anchor" href="#create-an-active-session"></a>
</h3>
<p>Panorama is a protected site and all user will need to authenticate
in order to order to explore the dashboards. Same is true for data
extraction. To create an active and valid session for all the http
requests, we will use <code><a href="../reference/pano_session.html">pano_session()</a></code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">load_secrets</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">user</span> <span class="op">&lt;-</span> <span class="fu">pano_user</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pass</span> <span class="op">&lt;-</span> <span class="fu">pano_pwd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-content-from-download-page">Extract content from download page<a class="anchor" aria-label="anchor" href="#extract-content-from-download-page"></a>
</h3>
<p>In order to extract the list of data items on the download page, we
will need an active session and the html content of the page. This can
be achieved with <code><a href="../reference/pano_items.html">pano_items()</a></code>. Under the wood, a valid
session is created, html elements extracted
(<code><a href="../reference/pano_content.html">pano_content()</a></code>) and parsed out
(<code><a href="../reference/pano_elements.html">pano_elements()</a></code>) as data frame.</p>
<p><code><a href="../reference/pano_items.html">pano_items()</a></code> combines <code><a href="../reference/pano_content.html">pano_content()</a></code> and
<code><a href="../reference/pano_elements.html">pano_elements()</a></code> into 1 function for a quick access to data
items list on a specific page.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://pepfar-panorama.org/forms/downloads/"</span></span>
<span></span>
<span><span class="va">mer_items</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pano_items.html">pano_items</a></span><span class="op">(</span>page_url <span class="op">=</span> <span class="va">dir_mer_path</span>, </span>
<span>                        username <span class="op">=</span> <span class="va">user</span>,</span>
<span>                        password <span class="op">=</span> <span class="va">pass</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">mer_items</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-specific-items-from-panorama">Download specific items from Panorama<a class="anchor" aria-label="anchor" href="#download-specific-items-from-panorama"></a>
</h3>
<p>Most data items under the download page of Panorama are listed as
zipped files. To download them to a local directory, we will need to use
the <code><a href="../reference/pano_download.html">pano_download()</a></code> function. This function is a wrapper
for <code><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">httr::GET()</a></code> function write option set to a local
directory.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dest_path</span> <span class="op">&lt;-</span> <span class="st">"../../../Temp/"</span></span>
<span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="va">mer_items</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"file zip_file"</span>,</span>
<span>         <span class="fu">str_detect</span><span class="op">(</span><span class="va">item</span>, <span class="st">".*_PSNU_IM_FY19-21_.*.zip$"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">first</span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">url</span></span>
<span></span>
<span><span class="fu"><a href="../reference/pano_download.html">pano_download</a></span><span class="op">(</span>item_url <span class="op">=</span> <span class="va">url</span>, session <span class="op">=</span> <span class="va">sess</span>, dest <span class="op">=</span> <span class="va">dest_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-mutiple-items-from-panorama">Download mutiple items from Panorama<a class="anchor" aria-label="anchor" href="#download-mutiple-items-from-panorama"></a>
</h3>
<p><code><a href="../reference/pano_extract.html">pano_extract()</a></code> is good for batch processing.</p>
<p>Eg: download all MER data sets from Panorama. This function combine
all the above steps into one.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pano_extract.html">pano_extract</a></span><span class="op">(</span>item <span class="op">=</span> <span class="st">"mer"</span>, </span>
<span>                      version <span class="op">=</span> <span class="st">"clean"</span>, </span>
<span>                      fiscal_year <span class="op">=</span> <span class="fl">2023</span>, </span>
<span>                      quarter <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                      username <span class="op">=</span> <span class="va">user</span>,</span>
<span>                      password <span class="op">=</span> <span class="va">pass</span>,</span>
<span>                      unpack <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">items</span></span>
<span></span>
<span><span class="va">url_items</span> <span class="op">&lt;-</span> <span class="va">items</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"file zip_file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">first</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># remove this to downlaod all zipped files</span></span>
<span>  <span class="fu">walk</span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="../reference/pano_download.html">pano_download</a></span><span class="op">(</span>item_url <span class="op">=</span> <span class="va">.x</span>, </span>
<span>                      session <span class="op">=</span> <span class="va">sess</span>, </span>
<span>                      dest <span class="op">=</span> <span class="va">dest_path</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-specific-msd-ou-specific-items-from-panorama">Download specific MSD / OU Specific items from Panorama<a class="anchor" aria-label="anchor" href="#download-specific-msd-ou-specific-items-from-panorama"></a>
</h3>
<p><code><a href="../reference/pano_extract_msd.html">pano_extract_msd()</a></code> is designed to facilitate the
download of MSD files for specific operating units and at a specific org
hierarchy level. Eg: download Zambia’s Site x IM data sets from
Panorama.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="../reference/pano_extract_msd.html">pano_extract_msd</a></span><span class="op">(</span>operatingunit <span class="op">=</span> <span class="st">"Zambia"</span>,</span>
<span>                   version <span class="op">=</span> <span class="st">"clean"</span>,</span>
<span>                   fiscal_year <span class="op">=</span> <span class="fl">2021</span>,</span>
<span>                   quarter <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                   level <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>                   dest_path <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-latest-msd-ou-specific-items-from-panorama">Download latest MSD / OU Specific items from Panorama<a class="anchor" aria-label="anchor" href="#download-latest-msd-ou-specific-items-from-panorama"></a>
</h3>
<p><code><a href="../reference/pano_extract_msds.html">pano_extract_msds()</a></code> is designed to facilitate the
download and management of latest MSD files for global and/or specific
operating units. The function will also move existing files to an
<code>Archive</code> folder before downloading current files. Users are
also able to include / exclude global datasets with
<code>add_global = TRUE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="../reference/pano_extract_msds.html">pano_extract_msds</a></span><span class="op">(</span>operatingunit <span class="op">=</span> <span class="st">"Zambia"</span>,</span>
<span>                    archive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    dest_path <span class="op">=</span> <span class="fu">si_path</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    username <span class="op">=</span> <span class="fu">pano_user</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    password <span class="op">=</span> <span class="fu">pano_pwd</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Aaron Chafetz, Tim Essam, Baboyma Kagniniwa.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
